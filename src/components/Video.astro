---
import presentation from "../assets/videos/presentation.mp4";
---

<video
  id="presentation-video"
  src={presentation}
  muted
  loop
  playsinline
  preload="metadata"
  class="w-full h-[70vh] md:h-auto md:aspect-video object-cover md:object-contain bg-black"
></video>

<script>
  function setupVideo() {
    const video = document.getElementById(
      "presentation-video",
    ) as HTMLVideoElement;

    if (video) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              video.play().catch((error: any) => {
                console.log("Autoplay failed:", error);
              });
            }
          });
        },
        {
          threshold: 0.5,
        },
      );

      observer.observe(video);
    }
  }

  // Initial load
  document.addEventListener("DOMContentLoaded", setupVideo);

  // After View Transitions
  document.addEventListener("astro:after-swap", setupVideo);
</script>
